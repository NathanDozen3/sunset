<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Find sunrise, sunset, golden hour, and blue hour times for any location and date. Interactive map, timezone support, and accessibility features.">
  <title>Sunrise and Sunset Times</title>
  <link rel="stylesheet" href="src/output.css">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body class="bg-gray-100 dark:bg-gray-900 min-h-screen flex flex-col items-center justify-start p-4">
  <div class="bg-white dark:bg-black rounded-lg shadow-lg p-6 max-w-lg w-full">
    <h1 class="text-3xl font-bold text-center text-gray-800 dark:text-gray-200 mb-4 flex items-center justify-center gap-2">Sunrise & Sunset Times</h1>
    <div class="flex flex-col gap-4">
      <div class="relative">
        <input type="text" id="searchInput" placeholder="Enter city or address" class="bg-white placeholder:text-gray-800 text-gray-800 dark:bg-gray-800 dark:placeholder:text-gray-100 dark:text-gray-100 w-full p-2 border dark:border-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" aria-label="Search location">
        <div id="autocomplete-list" class="absolute w-full bg-white text-black dark:bg-gray-900 dark:text-white border border-gray-300 rounded-lg mt-1 max-h-48 overflow-y-auto z-10 hidden"></div>
      </div>
      <div class="flex gap-2 items-center">
        <input type="date" id="dateInput" class="bg-white text-gray-800 dark:bg-gray-800 dark:text-gray-100 p-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 flex-1 dark:[&::-webkit-calendar-picker-indicator]:invert" aria-label="Select date">
        <button id="todayBtn" class="bg-yellow-700 text-white px-3 py-2 rounded-lg hover:bg-yellow-800 hover:cursor-pointer" aria-label="Today">Today</button>
      </div>
      <div class="flex gap-2">
        <button onclick="searchLocationSunTimes()" class="flex-1 bg-blue-700 text-white p-2 rounded-lg hover:bg-blue-800 hover:cursor-pointer" aria-label="Search">Search</button>
        <button onclick="resetToUserLocation()" class="flex-1 bg-gray-500 text-white p-2 rounded-lg hover:bg-gray-600 hover:cursor-pointer" aria-label="Use my location">Use My Location</button>
      </div>
    </div>
    <div id="loadingSpinner" class="hidden justify-center items-center mt-4" aria-live="polite">
      <svg class="animate-spin h-8 w-8 text-blue-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path></svg>
      <span class="ml-2 text-blue-700">Loading...</span>
    </div>
    <div id="errorMessage" class="mt-4 text-red-600 font-semibold hidden" role="alert"></div>
    <div class="mt-4 text-gray-700 dark:text-gray-200 hidden" id="resultsPanel" aria-live="polite">
      <div class="grid grid-cols-6 gap-2 md:gap-4">
        <div class="col-span-6 bg-white dark:bg-black border border-gray-200 dark:border-gray-700 rounded-lg p-3 flex flex-col items-center justify-center shadow-md">
          <span class="text-sm md:text-lg font-semibold text-gray-800 dark:text-gray-200">Location</span>
          <p id="location" class="text-center text-sm text-gray-600 dark:text-gray-400">Enter a location or use Use My Location</p>
        </div>
        <div class="col-span-3 bg-white dark:bg-black border border-gray-200 dark:border-gray-700 rounded-lg py-3 md:p-3 flex-1 flex flex-col items-center justify-center shadow-md">
          <span class="text-sm md:text-lg font-semibold text-gray-800 dark:text-gray-200">Timezone</span>
          <p id="timezone" class="text-center text-sm text-gray-600 dark:text-gray-400">--</p>
        </div>
        <div class="col-span-3 bg-white dark:bg-black border border-gray-200 dark:border-gray-700 rounded-lg py-3 md:p-3 flex-1 flex flex-col items-center justify-center shadow-md">
          <span class="text-sm md:text-lg font-semibold text-gray-800 dark:text-gray-200">Date</span>
          <p id="date" class="text-center text-sm text-gray-600 dark:text-gray-400">--</p>
        </div>
        <div class="col-span-2 bg-white dark:bg-black border border-gray-200 dark:border-gray-700 rounded-lg py-3 md:p-3 flex-1 flex flex-col items-center justify-center shadow-md">
          <span class="text-sm md:text-lg font-semibold text-gray-800 dark:text-gray-200">Dawn</span>
          <p id="bluehour-morning" class="text-center text-sm text-gray-600 dark:text-gray-400">--</p>
        </div>
        <div class="col-span-2 bg-white dark:bg-black border border-gray-200 dark:border-gray-700 rounded-lg py-3 md:p-3 flex-1 flex flex-col items-center justify-center shadow-md">
          <span class="text-sm md:text-lg font-semibold text-gray-800 dark:text-gray-200">Sunrise</span>
          <p id="sunrise" class="text-center text-sm text-gray-600 dark:text-gray-400">--</p>
        </div>
        <div class="col-span-2 bg-white dark:bg-black border border-gray-200 dark:border-gray-700 rounded-lg py-3 md:p-3 flex-1 flex flex-col items-center justify-center shadow-md">
          <span class="text-sm md:text-lg font-semibold text-gray-800 dark:text-gray-200">Golden</span>
          <p id="goldenhour-morning" class="text-center text-sm text-gray-600 dark:text-gray-400">--</p>
        </div>
        <div class="col-span-2 bg-white dark:bg-black border border-gray-200 dark:border-gray-700 rounded-lg py-3 md:p-3 flex-1 flex flex-col items-center justify-center shadow-md">
          <span class="text-sm md:text-lg font-semibold text-gray-800 dark:text-gray-200">Golden</span>
          <p id="goldenhour-evening" class="text-center text-sm text-gray-600 dark:text-gray-400">--</p>
        </div>
        <div class="col-span-2 bg-white dark:bg-black border border-gray-200 dark:border-gray-700 rounded-lg py-3 md:p-3 flex-1 flex flex-col items-center justify-center shadow-md">
          <span class="text-sm md:text-lg font-semibold text-gray-800 dark:text-gray-200">Sunset</span>
          <p id="sunset" class="text-center text-sm text-gray-600 dark:text-gray-400">--</p>
        </div>
        <div class="col-span-2 bg-white dark:bg-black border border-gray-200 dark:border-gray-700 rounded-lg py-3 md:p-3 flex-1 flex flex-col items-center justify-center shadow-md">
          <span class="text-sm md:text-lg font-semibold text-gray-800 dark:text-gray-200">Dusk</span>
          <p id="bluehour-evening" class="text-center text-sm text-gray-600 dark:text-gray-400">--</p>
        </div>
      </div>
    </div>
    <div class="mt-4 flex gap-2 justify-center">
      <button id="shareBtn" class="bg-indigo-700 text-white px-4 py-2 rounded-lg hover:bg-indigo-800 hover:cursor-pointer" aria-label="Share">Share</button>
      <button id="favoriteBtn" class="bg-pink-700 text-white px-4 py-2 rounded-lg hover:bg-pink-800 hover:cursor-pointer" aria-label="Save">Save</button>
      <button id="favoritesBtn" class="bg-green-700 text-white px-4 py-2 rounded-lg hover:bg-green-800 hover:cursor-pointer" aria-label="Show Favorites">Favorites</button>
    </div>
  </div>
  <div id="favoritesModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50" role="dialog" aria-labelledby="favoritesModalTitle">
    <div class="bg-white rounded-lg p-6 max-w-lg w-full m-4">
      <h2 id="favoritesModalTitle" class="text-xl font-bold mb-4 text-gray-800">Saved Favorites</h2>
      <ul id="favoritesList" class="space-y-2 max-h-64 overflow-y-auto"></ul>
      <div class="mt-4 flex justify-end">
        <button onclick="closeFavoritesModal()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 hover:cursor-pointer" aria-label="Close Favorites">Close</button>
      </div>
    </div>
  </div>
  <div id="map" class="w-full max-w-lg h-96 mt-4 rounded-lg shadow-lg hidden z-0" role="region" aria-label="Map"></div>
  <footer class="mt-4 text-sm text-center">
    <p class="text-gray-800 dark:text-gray-200">Data provided by <a href="https://www.openstreetmap.org/copyright" target="_blank" class="underline">OpenStreetMap</a> and <a href="https://nominatim.openstreetmap.org" target="_blank" class="underline">Nominatim</a>.</p>
    <button id="themeToggle" class="mt-2 bg-gray-200 px-3 py-1 rounded-lg hover:bg-gray-300 hover:cursor-pointer" aria-label="Toggle dark mode">Toggle Dark Mode</button>
  </footer>

  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/suncalc/1.9.0/suncalc.min.js"></script>
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script>
    const TIMEZONEDB_API_KEY = 'B0HKRH0IGONF';
    let map, marker, favorites = [];
    const loadingSpinner = document.getElementById('loadingSpinner');
    const errorMessage = document.getElementById('errorMessage');
    const resultsPanel = document.getElementById('resultsPanel');
    const todayBtn = document.getElementById('todayBtn');
    const shareBtn = document.getElementById('shareBtn');
    const favoriteBtn = document.getElementById('favoriteBtn');
    const favoritesBtn = document.getElementById('favoritesBtn');
    const favoritesModal = document.getElementById('favoritesModal');
    const favoritesList = document.getElementById('favoritesList');

    function showLoading(show) {
      loadingSpinner.classList.toggle('hidden', !show);
      loadingSpinner.classList.toggle('flex', show);
    }
    function showError(msg) {
      errorMessage.textContent = msg;
      errorMessage.classList.remove('hidden');
    }
    function clearError() {
      errorMessage.textContent = '';
      errorMessage.classList.add('hidden');
    }

    function updateResults({ location, timezone, date, sunrise, sunset, goldenhourMorning, goldenhourEvening, bluehourMorning, bluehourEvening }) {
      const locElem = document.getElementById('location');
      if (typeof location === 'string' && location) {
        const match = location.match(/^(.*?) \(Lat ([\d.-]+), Lon ([\d.-]+)\)$/);
        if (match) {
          locElem.innerHTML = `${match[1].replaceAll(', ', '<br class="md:hidden"><span class="hidden md:inline">, </span>')}<br><span class='text-xs text-gray-500 dark:text-gray-400'>Lat ${match[2]}, Lon ${match[3]}</span>`;
        } else {
          locElem.textContent = location;
        }
      } else {
        locElem.textContent = 'Unknown location';
      }
      document.getElementById('timezone').textContent = timezone || '--';
      document.getElementById('date').textContent = date || '--';
      document.getElementById('sunrise').textContent = sunrise || '--';
      document.getElementById('sunset').textContent = sunset || '--';
      document.getElementById('goldenhour-morning').textContent = `${goldenhourMorning || '--'}`;
      document.getElementById('goldenhour-evening').textContent = `${goldenhourEvening || '--'}`;
      document.getElementById('bluehour-morning').textContent = `${bluehourMorning || '--'}`;
      document.getElementById('bluehour-evening').textContent = `${bluehourEvening || '--'}`;
    }

    function getSunTimes(lat, lon, date, timezoneOffset) {
      const calcDate = date ? new Date(date + 'T00:00:00') : new Date();
      const times = SunCalc.getTimes(calcDate, lat, lon);
      const offsetMs = timezoneOffset * 1000;
      function format(dt) {
        return dt ? new Date(dt.getTime() + offsetMs).toLocaleTimeString([], { timeZone: 'UTC' }) : '--';
      }
      return {
        sunrise: format(times.sunrise),
        sunset: format(times.sunset),
        goldenhourMorning: format(times.goldenHourEnd),
        goldenhourEvening: format(times.goldenHour),
        bluehourMorning: format(times.dawn),
        bluehourEvening: format(times.dusk),
        date: calcDate.toLocaleDateString()
      };
    }

    async function getLocationName(lat, lon) {
      try {
        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=10`);
        const data = await response.json();
        return data.display_name || 'Unknown location';
      } catch (error) {
        return 'Location lookup failed';
      }
    }

    async function getTimezone(lat, lon) {
      try {
        const response = await fetch(`https://api.timezonedb.com/v2.1/get-time-zone?key=${TIMEZONEDB_API_KEY}&format=json&by=position&lat=${lat}&lng=${lon}`);
        const data = await response.json();
        if (data.status !== 'OK') throw new Error('Timezone lookup failed');
        return { zoneName: data.zoneName, offset: data.gmtOffset };
      } catch (error) {
        return { zoneName: 'Unknown', offset: 0 };
      }
    }

    async function fetchSuggestions(query) {
      if (!query) return [];
      try {
        const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=5`);
        const data = await response.json();
        return data.map(item => item.display_name);
      } catch (error) {
        return [];
      }
    }

    function setupAutocomplete() {
      const input = document.getElementById('searchInput');
      const autocompleteList = document.getElementById('autocomplete-list');
      let timeoutId;
      input.addEventListener('input', async () => {
        clearTimeout(timeoutId);
        autocompleteList.innerHTML = '<div class="p-2 text-gray-400">Loading...</div>';
        timeoutId = setTimeout(async () => {
          const query = input.value.trim();
          const suggestions = await fetchSuggestions(query);
          autocompleteList.innerHTML = '';
          autocompleteList.classList.toggle('hidden', suggestions.length === 0);
          if (suggestions.length > 0) {
            suggestions.forEach(suggestion => {
              const div = document.createElement('div');
              const regex = new RegExp(query, 'gi');
              div.innerHTML = suggestion.replace(regex, match => `<span class='bg-yellow-200 dark:bg-amber-800'>${match}</span>`);
              div.className = 'p-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800';
              div.tabIndex = 0;
              div.setAttribute('role', 'option');
              div.addEventListener('click', () => {
                input.value = suggestion;
                autocompleteList.innerHTML = '';
                autocompleteList.classList.add('hidden');
                searchLocationSunTimes();
              });
              div.addEventListener('keydown', e => {
                if (e.key === 'Enter') {
                  input.value = suggestion;
                  autocompleteList.innerHTML = '';
                  autocompleteList.classList.add('hidden');
                  searchLocationSunTimes();
                }
              });
              autocompleteList.appendChild(div);
            });
          }
        }, 300);
      });
      document.addEventListener('click', e => {
        if (!input.contains(e.target) && !autocompleteList.contains(e.target)) {
          autocompleteList.innerHTML = '';
          autocompleteList.classList.add('hidden');
        }
      });
    }

    function saveFavorite(location, lat, lon, date) {
      const exists = favorites.some(fav => fav.location === location && fav.date === date);
      if (exists) {
        showError('This location and date is already saved as a favorite');
        favoriteBtn.textContent = 'Already Saved';
        setTimeout(() => favoriteBtn.textContent = 'Save', 1500);
        return;
      }
      favorites.push({ location, lat: parseFloat(lat), lon: parseFloat(lon), date });
      localStorage.setItem('sunsetFavorites', JSON.stringify(favorites));
      favoriteBtn.textContent = 'Saved!';
      setTimeout(() => favoriteBtn.textContent = 'Save', 1500);
    }

    function loadFavorites() {
      const saved = localStorage.getItem('sunsetFavorites');
      if (saved) favorites = JSON.parse(saved);
      updateFavoritesList();
    }

    function updateFavoritesList() {
      favoritesList.innerHTML = '';
      if (favorites.length === 0) {
        favoritesList.innerHTML = '<li class="text-gray-500">No favorites saved</li>';
        return;
      }
      favorites.forEach((fav, index) => {
        const li = document.createElement('li');
        li.className = 'flex flex-col gap-2 justify-between items-center p-2 bg-gray-100 rounded-lg';
        li.innerHTML = `
          <span class="text-sm">${fav.location} (${fav.date})</span>
          <div class="flex gap-2">
            <button class="load-btn bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 hover:cursor-pointer" data-index="${index}" aria-label="Load favorite ${fav.location}">Load</button>
            <button class="delete-btn bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 hover:cursor-pointer" data-index="${index}" aria-label="Delete favorite ${fav.location}">Delete</button>
          </div>
        `;
        favoritesList.appendChild(li);
      });
      document.querySelectorAll('.load-btn').forEach(btn => {
        btn.addEventListener('click', () => loadFavorite(btn.dataset.index));
      });
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', () => deleteFavorite(btn.dataset.index));
      });
    }

    function loadFavorite(index) {
      const fav = favorites[index];
      if (!fav) return;
      document.getElementById('searchInput').value = fav.location;
      document.getElementById('dateInput').value = fav.date;
      showLoading(true);
      showResultsPanel(true);
      clearError();
      getTimezone(fav.lat, fav.lon).then(({ zoneName, offset }) => {
        const sun = getSunTimes(fav.lat, fav.lon, fav.date, offset);
        updateResults({
          location: `${fav.location} (Lat ${fav.lat.toFixed(2)}, Lon ${fav.lon.toFixed(2)})`,
          timezone: zoneName,
          date: sun.date,
          sunrise: sun.sunrise,
          sunset: sun.sunset,
          goldenhourMorning: sun.goldenhourMorning,
          goldenhourEvening: sun.goldenhourEvening,
          bluehourMorning: sun.bluehourMorning,
          bluehourEvening: sun.bluehourEvening
        });
        initMap(fav.lat, fav.lon, fav.location);
        favoriteBtn.onclick = () => saveFavorite(fav.location, fav.lat, fav.lon, fav.date);
        closeFavoritesModal();
        showLoading(false);
      }).catch(error => {
        showError(error.message || 'Failed to load favorite');
        showLoading(false);
      });
    }

    function deleteFavorite(index) {
      favorites.splice(index, 1);
      localStorage.setItem('sunsetFavorites', JSON.stringify(favorites));
      updateFavoritesList();
    }

    function openFavoritesModal() {
      updateFavoritesList();
      favoritesModal.classList.remove('hidden');
    }

    function closeFavoritesModal() {
      favoritesModal.classList.add('hidden');
    }

    function shareResults() {
      const location = document.getElementById('location').textContent;
      const date = document.getElementById('date').textContent;
      const sunrise = document.getElementById('sunrise').textContent;
      const sunset = document.getElementById('sunset').textContent;
      const text = `Sunrise & Sunset for ${location} on ${date}:\nSunrise: ${sunrise}\nSunset: ${sunset}`;
      if (navigator.share) {
        navigator.share({ title: 'Sunrise & Sunset Times', text });
      } else {
        navigator.clipboard.writeText(text);
        shareBtn.textContent = 'Copied!';
        setTimeout(() => shareBtn.textContent = 'Share', 1500);
      }
    }

    function toggleTheme() {
      document.body.classList.toggle('dark');
    }

    function setToday() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('dateInput').value = today;
    }

    function showResultsPanel(show) {
      resultsPanel.classList.toggle('hidden', !show);
    }

    function initMap(lat, lon, locationName) {
      document.getElementById('map').classList.remove('hidden'); // Show map
      if (map) map.remove();
      map = L.map('map').setView([lat, lon], 13);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);
      marker = L.marker([lat, lon]).addTo(map)
        .bindPopup(locationName)
        .openPopup();
      map.on('click', async function(e) {
        showLoading(true);
        clearError();
        const lat = e.latlng.lat, lon = e.latlng.lng;
        const locationName = await getLocationName(lat, lon);
        try {
          const { zoneName, offset } = await getTimezone(lat, lon);
          const sun = getSunTimes(lat, lon, document.getElementById('dateInput').value, offset);
          document.getElementById('searchInput').value = locationName;
          updateResults({
            location: `${locationName} (Lat ${lat.toFixed(2)}, Lon ${lon.toFixed(2)})`,
            timezone: zoneName,
            date: sun.date,
            sunrise: sun.sunrise,
            sunset: sun.sunset,
            goldenhourMorning: sun.goldenhourMorning,
            goldenhourEvening: sun.goldenhourEvening,
            bluehourMorning: sun.bluehourMorning,
            bluehourEvening: sun.bluehourEvening
          });
          marker.setLatLng([lat, lon]).setPopupContent(locationName).openPopup();
          favoriteBtn.onclick = () => saveFavorite(locationName, lat, lon, document.getElementById('dateInput').value);
        } catch (error) {
          showError(error.message || 'Map location error');
        }
        showLoading(false);
      });
    }

    async function searchLocationSunTimes() {
      clearError();
      showLoading(true);
      showResultsPanel(true);
      const query = document.getElementById('searchInput').value.trim();
      const date = document.getElementById('dateInput').value;
      if (!query) {
        showError('Please enter a location');
        showLoading(false);
        return;
      }
      try {
        const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`);
        const data = await response.json();
        if (data.length === 0) {
          showError('Location not found');
          showLoading(false);
          return;
        }
        const { lat, lon, display_name } = data[0];
        const { zoneName, offset } = await getTimezone(lat, lon);
        const sun = getSunTimes(lat, lon, date, offset);
        document.getElementById('searchInput').value = display_name;
        updateResults({
          location: `${display_name} (Lat ${parseFloat(lat).toFixed(2)}, Lon ${parseFloat(lon).toFixed(2)})`,
          timezone: zoneName,
          date: sun.date,
          sunrise: sun.sunrise,
          sunset: sun.sunset,
          goldenhourMorning: sun.goldenhourMorning,
          goldenhourEvening: sun.goldenhourEvening,
          bluehourMorning: sun.bluehourMorning,
          bluehourEvening: sun.bluehourEvening
        });
        initMap(parseFloat(lat), parseFloat(lon), display_name);
        favoriteBtn.onclick = () => saveFavorite(display_name, lat, lon, date);
      } catch (error) {
        showError(error.message || 'Search failed');
      }
      showLoading(false);
    }

    async function getUserLocationSunTimes() {
      clearError();
      showLoading(true);
      showResultsPanel(true);
      if (!navigator.geolocation) {
        showError('Geolocation not supported');
        showLoading(false);
        return;
      }
      const date = document.getElementById('dateInput').value;
      navigator.geolocation.getCurrentPosition(
        async position => {
          const { latitude, longitude } = position.coords;
          const { zoneName, offset } = await getTimezone(latitude, longitude);
          const sun = getSunTimes(latitude, longitude, date, offset);
          const locationName = await getLocationName(latitude, longitude);
          document.getElementById('searchInput').value = locationName;
          updateResults({
            location: `${locationName} (Lat ${latitude.toFixed(2)}, Lon ${longitude.toFixed(2)})`,
            timezone: zoneName,
            date: sun.date,
            sunrise: sun.sunrise,
            sunset: sun.sunset,
            goldenhourMorning: sun.goldenhourMorning,
            goldenhourEvening: sun.goldenhourEvening,
            bluehourMorning: sun.bluehourMorning,
            bluehourEvening: sun.bluehourEvening
          });
          initMap(latitude, longitude, locationName);
          favoriteBtn.onclick = () => saveFavorite(locationName, latitude, longitude, date);
          showLoading(false);
        },
        error => {
          let errorMessage = 'Unable to fetch location';
          switch (error.code) {
            case error.PERMISSION_DENIED:
              errorMessage = 'Location access denied';
              break;
            case error.POSITION_UNAVAILABLE:
              errorMessage = 'Location unavailable';
              break;
            case error.TIMEOUT:
              errorMessage = 'Location request timed out';
              break;
          }
          showError(errorMessage);
          showLoading(false);
        },
        { timeout: 10000, maximumAge: 60000 }
      );
    }

    function resetToUserLocation() {
      document.getElementById('searchInput').value = '';
      document.getElementById('autocomplete-list').innerHTML = '';
      setToday();
      getUserLocationSunTimes();
    }

    window.onload = () => {
      setToday();
      loadFavorites();
      setupAutocomplete();
      todayBtn.onclick = setToday;
      shareBtn.onclick = shareResults;
      favoritesBtn.onclick = openFavoritesModal;
      themeToggle.onclick = toggleTheme;
      showResultsPanel(false);
    };
  </script>
</body>
</html>